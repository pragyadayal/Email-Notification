name: Check Email Notification

on:
 workflow_dispatch:

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Compile the program
      run: make
    - name: Upload artifact to JFrog Artifactory
      run: |
         curl -u ${{ secrets.JFROG_USER }}:${{ secrets.JFROG_PASSWORD }} \
            -T ./main "https://192.168.27.95/artifactory/example-repo-local/"

  notify-success:
    needs: build
    if: success()
    runs-on: ubuntu-latest
    steps:
    - name: Send Success Email
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.EMAIL_FROM }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject:  "✅ SUCCESS: ${{ github.repository }} on ${{ github.ref_name }}"

        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}
        body: |
            ✅ Build Succeeded!

            🔧 Job: build
            📦 Repository: ${{ github.repository }}
            🌿 Branch: ${{ github.ref_name }}
            🕒 Time: ${{ github.event.head_commit.timestamp }}
            🧑‍💻 Triggered by: ${{ github.actor }}
            🔗 Check Logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
  
  notify-failure:
    needs: build
    if: failure()
    runs-on: ubuntu-latest
    steps:
    - name: Send Failure Email
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.EMAIL_FROM }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "❌ FAILURE: ${{ github.repository }} on ${{ github.ref_name }}"
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_FROM }}
        body: |
          ❗ Build Failed
          🔧 Job: build
          📦 Repository: ${{ github.repository }}
          🌿 Branch: ${{ github.ref_name }}
          🕒 Time: ${{ github.event.head_commit.timestamp }}
          💬 Commit: ${{ github.event.head_commit.message }}
          🧑‍💻 Triggered by: ${{ github.actor }}
          🔗 Check Logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
